<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Food - FWG</title>
    <meta name="description" content="A responsive bootstrap 4 admin dashboard template by hencework" />

    <!-- Favicon -->
    <link rel="shortcut icon" href="dist/img/favi.ico">
    <link rel="icon" href="dist/img/favi.ico" type="image/x-icon">

    <!-- Morris Charts CSS -->
    <link href="dist/vendors4/morris.js/morris.css" rel="stylesheet" type="text/css" />

    <!-- Data Table CSS -->
    <link href="dist/vendors4/datatables.net-dt/css/jquery.dataTables.min.css" rel="stylesheet" type="text/css" />
    <link href="dist/vendors4/datatables.net-responsive-dt/css/responsive.dataTables.min.css" rel="stylesheet"
        type="text/css" />

    <!-- Toggles CSS -->
    <link href="dist/vendors4/jquery-toggles/css/toggles.css" rel="stylesheet" type="text/css">
    <link href="dist/vendors4/jquery-toggles/css/themes/toggles-light.css" rel="stylesheet" type="text/css">

    <!-- Toastr CSS -->
    <link href="dist/vendors4/jquery-toast-plugin/dist/jquery.toast.min.css" rel="stylesheet" type="text/css">

    <!-- Pace -->
    <link rel="stylesheet" href="dist/vendors4/pace-progress/themes/blue/pace-theme-minimal.css">

    <!-- Custom CSS -->
    <link href="dist/css/style.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="dist/css/fontawesome-free/css/all.min.css">
</head>

<body>
    <!-- HK Wrapper -->
    <div class="hk-wrapper hk-vertical-nav">

       <!-- Top Navbar -->
        <nav class="navbar navbar-expand-xl navbar-light fixed-top hk-navbar py-md-0 py-2" style="flex-wrap: nowrap;">
            <a id="navbar_toggle_btn" class="navbar-toggle-btn nav-link-hover" href="javascript:void(0);"><i
                    class="ion ion-ios-menu"></i></a>
            <a class="navbar-brand d-md-block d-none" href="admin.html">
                <img class="brand-img d-inline-block mr-5" src="dist/img/fitit-logo.png" alt="brand" width="10%" />
            </a>
            <a class="navbar-brand d-md-none d-block" href="admin.html">
                <img class="brand-img d-inline-block mr-5 mt-2" src="dist/img/fitit-logo.png" alt="brand" width="25%" />
            </a>
            <ul class="navbar-nav hk-navbar-content" id="ui_header_profile"></ul>
        </nav>
        <!-- /Top Navbar -->

        <!--Vertical Nav-->
        <div id="navHTML"></div>
        <div id="hk_nav_backdrop" class="hk-nav-backdrop"></div>
        <!--/Vertical Nav-->

        <!-- Main Content -->
        <div class="hk-pg-wrapper">
            <div class="container-fluid">
                <div class="container content-header">
                    <div class="row mt-sm-30 mt-30 align-items-center">
                        <div class="col-md-6">
                            <h1>Food Details</h1>
                        </div>
                        <div class="col-md-6">
                            <!-- Breadcrumb -->
                            <nav class="hk-breadcrumb" aria-label="breadcrumb">
                                <ol class="breadcrumb bg-transparent float-sm-right mb-0 pl-0 pl-md-3">
                                    <li class="breadcrumb-item"><a href="admin.html">Home</a></li>
                                    <li class="breadcrumb-item active" aria-current="page">Food</li>
                                </ol>
                            </nav>
                            <!-- /Breadcrumb -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- Container -->
            <div class="container-fluid mt-sm-30 mt-15">
                <!-- Row -->
                <div class="row">
                    <div class="col-xl-12">
                        <!-- Wrapper -->
                        <section class="hk-sec-wrapper">
                            <div class="row">
                                <div class="col-md-12 form-group">

                                    <div class="table-wrap">
                                        <table id="tbl_food" class="mt-15 table table-bordered responsive nowrap pb-30"
                                            style="width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>No.</th>
                                                    <th>Food Name</th>
                                                    <th>Fat</th>
                                                    <th>Calories</th>
                                                    <th>Carbohydrates</th>
                                                    <th>Protein</th>
                                                    <th>Quantity</th>
                                                    <th>Action</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr align="center">
                                                    <td colspan="9"><img src="dist/img/loader.gif" style="width:30px">
                                                    </td>
                                                    <td hidden></td>
                                                    <td hidden></td>
                                                    <td hidden></td>
                                                    <td hidden></td>
                                                    <td hidden></td>
                                                    <td hidden></td>
                                                    <td hidden></td>
                                                </tr>
                                            </tbody>
                                            <tfoot>
                                                <tr>
                                                    <th>No.</th>
                                                    <th>Food Name</th>
                                                    <th>Fat</th>
                                                    <th>Calories</th>
                                                    <th>Carbohydrates</th>
                                                    <th>Protein</th>
                                                    <th>Quantity</th>
                                                    <th>Action</th>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
                <!-- /Row -->
            </div>
            <!-- /Container -->


        </div>
        <!-- /Main Content -->

    </div>
    <!-- /HK Wrapper -->

    <!-- Modal -->
    <div class="modal fade" id="modal_food" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Food</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="row">
                                <div class="col-md-12">
                                    <label for="txt_name">Name</label>
                                    <input type="text" id="txt_name" class="form-control form-group"
                                        placeholder="Food Name">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="txt_protein">Protein</label>
                                    <input type="text" id="txt_protein" class="form-control form-group"
                                        placeholder="Protein">
                                </div>
                                <div class="col-md-6">
                                    <label for="txt_carbs">Carbohydrates</label>
                                    <input type="text" id="txt_carbs" class="form-control form-group"
                                        placeholder="Carbohydrates">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="txt_calories">Calories</label>
                                    <input type="text" id="txt_calories" class="form-control form-group"
                                        placeholder="Calories" disabled>
                                </div>
                                <div class="col-md-6">
                                    <label for="txt_fats">Fats</label>
                                    <input type="text" id="txt_fats" class="form-control form-group" placeholder="Fats">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="txt_quantity">Quantity Unit</label>
                                    <input type="text" id="txt_quantity" class="form-control form-group"
                                        placeholder="Quantity Unit">
                                </div>
                                <div class="col-md-6">
                                    <label for="txt_quantity_unit">Quantity</label>

                                    <select id="txt_quantity_unit" class="form-control form-group">
                                        <option value="" hidden>Select Unit</option>
                                        <option value="GRAM">Gram</option>
                                        <option value="KILOGRAM">Kilogram</option>
                                        <option value="NOS">NOS</option>
                                        <option value="MILLIGRAM">Milligram</option>
                                        <option value="LITRE">litre</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="btn_addFood" class="btn btn-primary" style="display:none;">
                        <i class="fa fa-plus"></i> &nbsp; Add</button>
                    <div id="div_button">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script src="dist/vendors4/jquery/dist/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="dist/vendors4/popper.js/dist/umd/popper.min.js"></script>
    <script src="dist/vendors4/bootstrap/dist/js/bootstrap.min.js"></script>

    <!-- Slimscroll JavaScript -->
    <script src="dist/js/jquery.slimscroll.js"></script>

    <!-- Fancy Dropdown JS -->
    <script src="dist/js/dropdown-bootstrap-extended.js"></script>

    <!-- FeatherIcons JavaScript -->
    <script src="dist/js/feather.min.js"></script>

    <!-- Toggles JavaScript -->
    <script src="dist/vendors4/jquery-toggles/toggles.min.js"></script>
    <script src="dist/js/toggle-data.js"></script>

    <!-- Toastr JS -->
    <script src="dist/vendors4/jquery-toast-plugin/dist/jquery.toast.min.js"></script>

    <!-- Counter Animation JavaScript -->
    <script src="dist/vendors4/waypoints/lib/jquery.waypoints.min.js"></script>
    <script src="dist/vendors4/jquery.counterup/jquery.counterup.min.js"></script>

    <!-- Data Table JavaScript -->
    <script src="dist/vendors4/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="dist/vendors4/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="dist/vendors4/datatables.net-dt/js/dataTables.dataTables.min.js"></script>
    <script src="dist/vendors4/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="dist/vendors4/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
    <script src="dist/vendors4/datatables.net-buttons/js/buttons.flash.min.js"></script>
    <script src="dist/vendors4/jszip/dist/jszip.min.js"></script>
    <script src="dist/vendors4/pdfmake/build/pdfmake.min.js"></script>
    <script src="dist/vendors4/pdfmake/build/vfs_fonts.js"></script>
    <script src="dist/vendors4/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="dist/vendors4/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="dist/vendors4/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="dist/js/dataTables-data.js"></script>
    <link rel="stylesheet" href="dist/vendors4/datatables.net-bs4/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="dist/vendors4/Responsive-2.3.0/css/responsive.bootstrap.min.css">
    <!-- Morris Charts JavaScript -->
    <script src="dist/vendors4/raphael/raphael.min.js"></script>
    <script src="dist/vendors4/morris.js/morris.min.js"></script>

    <!-- Easy pie chart JS -->
    <script src="dist/vendors4/easy-pie-chart/dist/jquery.easypiechart.min.js"></script>

    <!-- Sweet-alert -->
    <script src="dist/sweetalert2.js"></script>

    <!-- EChartJS JavaScript -->
    <script src="dist/vendors4/echarts/dist/echarts-en.min.js"></script>

    <!-- Init JavaScript -->
    <script src="dist/js/init.js"></script>
    <script src="dist/js/dashboard2-data.js"></script>

    <!-- Pace -->
    <script src="dist/vendors4/pace-progress/pace.min.js"></script>

    <!-- Custom js -->
    <script src="dist/app.js"></script>
    <script src="dist/menu-items.js"></script>

    <!-- Authorization -->
    <script src="dist/authorization.js"></script>
</body>
<script>
    let searchParams = new URLSearchParams(window.location.search);

    var tblFood = $('#tbl_food').DataTable({
        destroy: true,
        responsive: true,
        lengthMenu: [10, 25, 50, 75, 100, 200, 500, 800, 1000],
        pageLength: 10,
        language: {
            search: "_INPUT_",
            searchPlaceholder: "Search...",
            "sLengthMenu": "Show _MENU_ Records",
        },
        "dom": '<"row"<"#idid.col-7"><"col-5"fl><"col-12"rt><"col-12">><"row"<"col-12"ip>><"clear">',
        "columns": [{
            "width": "2%"
        }, {
            "width": "10%"
        }, {
            "width": "5%"
        }, {
            "width": "5%"
        }, {
            "width": "5%"
        }, {
            "width": "5%"
        }, {
            "width": "10%"
        }, {
            "width": "20%"
        }]
    });
    // Add content to col-7
    $('#idid').html(
        '<div class="">' +
        '<button class="btn mb-2 text-white" style="background-color: #0854ff;" id="btn_add"><i class="fa fa-plus"></i> &nbsp;Add</button>' +
        '</div>');

    $(document).ready(() => {
        getFood();

    })

    var foodData

    //get Video
    function getFood() {
        $.get({
            url: BASE_URL + '/food/get',
            success: (result) => {
                tblFood.clear().draw();
                foodData = result.data;
                for (var i = 0; i < foodData.length; i++) {
                    var tempFood = foodData[i];

                    var button = `<div class="btn-group"><button class='btn btn-primary m-1' onclick="editTime(${i},'${tempFood._id}')"><i class="fas fa-pencil-alt"></i>&nbsp;Edit</button><button type="button" class="btn btn-danger m-1" id="btn_remove_${i}" onclick=remove(${i},'${tempFood._id}')><i class="fa fa-trash"></i> Remove</button></div>`;
                    tblFood.row.add([
                        `${i + 1}`, tempFood.food_name, tempFood.fats, tempFood.calories, tempFood.carbs, tempFood.protein, tempFood.quantity + '&nbsp;' + tempFood.quantity_unit, button
                    ]).draw();
                }

                tblFood = initTable('tbl_food')

                if (searchParams.has('food_name') && searchParams.get('food_name') != '') {
                    tblFood.search(searchParams.get('food_name')).draw();
                }
            },
            error: (error) => {
                return error.responseJSON ? toastError('Error', error.responseJSON.message) : toastError();

            }
        });
    }

    //Open model for add new video
    $("#btn_add").click(() => {
        $('#txt_name').val('');
        $('#txt_carbs').val('');
        $('#txt_protein').val('');
        $('#txt_calories').val(0);
        $('#txt_fats').val('');
        $('#txt_quantity').val('');
        $('#btn_addFood').show();
        $('#modal_food').modal('show');
        $('#div_button').empty();
    });


    //Adding Time
    $("#btn_addFood").click(async () => {
        var food_name = ($('#txt_name').val()).trim(),
            calories = ($('#txt_calories').val()).trim(),
            carbs = ($('#txt_carbs').val()).trim(),
            fats = ($('#txt_fats').val()).trim(),
            quantity = ($('#txt_quantity').val()).trim(),
            quantity_unit = ($('#txt_quantity_unit').val()).trim(),
            protein = ($('#txt_protein').val()).trim();
        if (!food_name || !calories || !carbs || !fats || !protein || !quantity || !quantity_unit) {
            return $.toast({
                heading: 'Error!',
                text: 'All Data Required',
                position: 'top-right',
                loaderBg: '#f21d1d',
                class: 'jq-toast-danger',
                hideAfter: 3500,
                stack: 6,
                showHideTransition: 'fade'
            });
        }
        if (isNaN(calories) || isNaN(carbs) || isNaN(fats) || isNaN(protein) || isNaN(quantity)) {
            return $.toast({
                heading: 'Error!',
                text: 'Calories, Carbs, Fats, Quantity and Protein must be numbers',
                position: 'top-right',
                loaderBg: '#f21d1d',
                class: 'jq-toast-danger',
                hideAfter: 3500,
                stack: 6,
                showHideTransition: 'fade'
            });
        }
        if (calories <= 0 || carbs <= 0 || fats <= 0 || protein <= 0 || quantity <= 0) {
            return $.toast({
                heading: 'Error!',
                text: 'Calories, Carbs, Fats and Protein must be positive numbers',
                position: 'top-right',
                loaderBg: '#f21d1d',
                class: 'jq-toast-danger',
                hideAfter: 3500,
                stack: 6,
                showHideTransition: 'fade'
            });
        }
        let sendBodyObject = {
            food_name,
            calories,
            carbs,
            fats,
            protein,
            quantity,
            quantity_unit
        }
        $.post({
            url: BASE_URL + '/food/add',
            contentType: 'application/json',
            data: JSON.stringify(sendBodyObject),
            success: (result) => {
                $.toast({
                    heading: 'Successful',
                    text: "Food added successfully",
                    position: 'top-right',
                    loaderBg: '#08526e',
                    class: 'jq-toast-success',
                    hideAfter: 5000,
                    stack: 6,
                    showHideTransition: 'fade'
                });
                $('#modal_food').modal('hide');
                getFood();
            },
            error: (error) => {
                var error = error.responseJSON
                $.toast({
                    heading: 'Error!',
                    text: error.message,
                    position: 'top-right',
                    loaderBg: '#f21d1d',
                    class: 'jq-toast-danger',
                    hideAfter: 3500,
                    stack: 6,
                    showHideTransition: 'fade'
                });
            },
            beforeSend: () => {
                $(`#btn_addFood`).attr('disabled', true)
            },
            complete: () => {
                $(`#btn_addFood`).removeAttr('disabled')
            }
        });
    });

    //button change file
    $("#btn_imageFile").click(() => {
        // $("#btn_imageFile").hide();
        // $("#file_image").show();
        $("#file_image").click();
    })

    // Edit Food-Time
    function editTime(index, food_id) {
        $('#btn_addFood,#file_image').hide();
        $('#div_button').empty();
        $("#file_image").val('');
        $('#txt_quantity').val('');
        $('#txt_quantity_unit').val('');
        $('#modal_food').modal('show');

        if (foodData) {
            for (var i = 0; i < foodData.length; i++) {
                var tempFood = foodData[i],
                    button = `<button type="button" class="btn btn-info" id="btn_update_${i}" onclick=update(${i},'${food_id}')><i class="fa fa-check"></i> Save Changes</button>`
                if (tempFood._id == food_id) {
                    $('#txt_name').val(tempFood.food_name);
                    $('#txt_carbs').val(tempFood.carbs);
                    $('#txt_protein').val(tempFood.protein);
                    $('#txt_quantity').val(tempFood.quantity);
                    $('#txt_quantity_unit').val(tempFood.quantity_unit);
                    $('#txt_calories').val(tempFood.calories);
                    $('#txt_fats').val(tempFood.fats);
                    $('#div_button').append(button);
                }
            }
        }
    }

    //Updating Time
    async function update(index, id) {
        var food_name = ($('#txt_name').val()).trim(),
            calories = ($('#txt_calories').val()).trim(),
            carbs = ($('#txt_carbs').val()).trim(),
            fats = ($('#txt_fats').val()).trim(),
            quantity = ($('#txt_quantity').val()).trim(),
            quantity_unit = ($('#txt_quantity_unit').val()).trim(),
            protein = ($('#txt_protein').val()).trim();

        if (isNaN(calories) || isNaN(carbs) || isNaN(fats) || isNaN(protein)) {
            return $.toast({
                heading: 'Error!',
                text: 'Calories, Carbs, Fats and Protein must be numbers',
                position: 'top-right',
                loaderBg: '#f21d1d',
                class: 'jq-toast-danger',
                hideAfter: 3500,
                stack: 6,
                showHideTransition: 'fade'
            });
        }
        if (calories <= 0 || carbs <= 0 || fats <= 0 || protein <= 0 || quantity <= 0) {
            return $.toast({
                heading: 'Error!',
                text: 'Calories, Carbs, Fats and Protein must be positive numbers',
                position: 'top-right',
                loaderBg: '#f21d1d',
                class: 'jq-toast-danger',
                hideAfter: 3500,
                stack: 6,
                showHideTransition: 'fade'
            });
        }

        let sendBodyObject = {
            id,
            food_name,
            calories,
            carbs,
            fats,
            protein,
            quantity,
            quantity_unit
        }
        $.post({
            url: BASE_URL + '/food/update',
            contentType: 'application/json',
            data: JSON.stringify(sendBodyObject),
            success: (result) => {
                $.toast({
                    heading: 'Successful',
                    text: "Food Updated successfully",
                    position: 'top-right',
                    loaderBg: '#08526e',
                    class: 'jq-toast-success',
                    hideAfter: 5000,
                    stack: 6,
                    showHideTransition: 'fade'
                });
                $('#modal_food').modal('hide');
                getFood();
            },
            error: (error) => {
                var error = error.responseJSON
                $.toast({
                    heading: 'Error!',
                    text: error.message,
                    position: 'top-right',
                    loaderBg: '#f21d1d',
                    class: 'jq-toast-danger',
                    hideAfter: 3500,
                    stack: 6,
                    showHideTransition: 'fade'
                });
            },
            beforeSend: () => {
                $(`#btn_update_${index}`).attr('disabled', true)
            },
            complete: () => {
                $(`#btn_update_${index}`).removeAttr('disabled')
            }
        });
    }

    //Removing Video
    function remove(index, id) {
        Swal.fire({
            title: 'Are you sure?',
            text: "You want to remove this Food Item",
            icon: 'question',
            showCancelButton: true,
            confirmButtonText: 'Remove'
        }).then((result) => {
            if (result.value) {
                $.post({
                    url: BASE_URL + '/food/remove',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        id
                    }),
                    success: (result) => {
                        result = result.data;
                        $.toast({
                            heading: 'Successful',
                            text: "Food Item removed successfully",
                            position: 'top-right',
                            loaderBg: '#08526e',
                            class: 'jq-toast-success',
                            hideAfter: 3500,
                            stack: 6,
                            showHideTransition: 'fade'
                        });
                        getFood();
                    },
                    error: (error) => {
                        var error = error.responseJSON
                        $.toast({
                            heading: 'Error!',
                            text: error.message,
                            position: 'top-right',
                            loaderBg: '#08526e',
                            class: 'jq-toast-danger',
                            hideAfter: 5000,
                            stack: 6,
                            showHideTransition: 'fade'
                        });
                    },
                    beforeSend: () => {
                        $(`#btn_remove_${index}`).attr('disabled', true)
                    },
                    complete: () => {
                        $(`#btn_remove_${index}`).removeAttr('disabled')
                    }
                });
            }
        });
    }
    let protein, carbs, fats, calories;

    $('#txt_protein,#txt_carbs,#txt_fats').on('change', function () {
        caloriesCount()
    });

    function caloriesCount() {
        protein = (Number($('#txt_protein').val() || 0) * 4);
        carbs = (Number($('#txt_carbs').val() || 0) * 4);
        fats = (Number($('#txt_fats').val() || 0) * 9);
        if (isNaN(protein)) {
            calories = 0;
        } else {
            calories = protein + carbs + fats;
        }


        $('#txt_calories').val(calories)
    }
</script>

</html>