<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Exercise Details - FWG</title>
    <meta name="description" content="A responsive bootstrap 4 admin dashboard template by hence work" />

    <!-- Favicon -->
    <link rel="shortcut icon" href="dist/img/favi.ico">
    <link rel="icon" href="dist/img/favi.ico" type="image/x-icon">

    <!-- Morris Charts CSS -->
    <link href="dist/vendors4/morris.js/morris.css" rel="stylesheet" type="text/css" />

    <!-- Data Table CSS -->
    <link href="dist/vendors4/datatables.net-dt/css/jquery.dataTables.min.css" rel="stylesheet" type="text/css" />
    <link href="dist/vendors4/datatables.net-responsive-dt/css/responsive.dataTables.min.css" rel="stylesheet"
        type="text/css" />

    <!-- select2 CSS -->
    <link href="dist/vendors4/select2/dist/css/select2.min.css" rel="stylesheet" type="text/css" />

    <!-- Toggles CSS -->
    <link href="dist/vendors4/jquery-toggles/css/toggles.css" rel="stylesheet" type="text/css">
    <link href="dist/vendors4/jquery-toggles/css/themes/toggles-light.css" rel="stylesheet" type="text/css">

    <!-- Toastr CSS -->
    <link href="dist/vendors4/jquery-toast-plugin/dist/jquery.toast.min.css" rel="stylesheet" type="text/css">

    <!-- Pace -->
    <link rel="stylesheet" href="dist/vendors4/pace-progress/themes/blue/pace-theme-minimal.css">

    <!-- Custom CSS -->
    <link href="dist/css/style.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="dist/css/fontawesome-free/css/all.min.css">

    <style>
        .toolbar {
            float: left;
        }

        .dietPdf {
            color: #1f1f1f;
        }

        .diet-head p {
            font-size: 16px;
            padding: 5px;
        }

        .diet-head span {
            font-weight: 500;
        }

        /* Hide print and download PDF buttons when printing */
        @media print {
            .dietPdf {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .print-button,
            .download-pdf-button {
                display: none;
            }

            #create-dietPdf {
                display: none;
            }

            .dietPdf {
                width: 300mm;
                height: 250mm;
                margin: 0;
                box-shadow: none;
            }

            .footer {
                display: none;
            }
        }
    </style>
</head>

<body>
    <!-- HK Wrapper -->
    <div class="hk-wrapper hk-vertical-nav">

        <!-- Top Navbar -->
        <nav class="navbar navbar-expand-xl navbar-light fixed-top hk-navbar">
            <a id="navbar_toggle_btn" class="navbar-toggle-btn nav-link-hover" href="javascript:void(0);"><i
                    class="ion ion-ios-menu"></i></a>
            <a class="navbar-brand" href="admin.html">
                <img class="brand-img d-inline-block mr-5" src="dist/img/fitit-logo.png" alt="brand" width="10%" />
            </a>
            <ul class="navbar-nav hk-navbar-content" id="ui_header_profile"></ul>
        </nav>
        <!-- /Top Navbar -->

        <!--Vertical Nav-->
        <div id="navHTML"></div>
        <div id="hk_nav_backdrop" class="hk-nav-backdrop"></div>
        <!--/Vertical Nav-->

        <!-- Main Content -->
        <div class="hk-pg-wrapper">
            <div class="container-fluid">
                <div class="container content-header">
                    <div class="row mt-15 mb-15 align-items-center">
                        <div class="col-md-6">
                            <h1>Exercise Plan</h1>
                        </div>
                        <div class="col-md-6">
                            <!-- Breadcrumb -->
                            <nav class="hk-breadcrumb" aria-label="breadcrumb">
                                <ol class="breadcrumb bg-transparent float-sm-right mb-0">
                                    <li class="breadcrumb-item"><a href="admin.html?menu_item=menu_dashboard">Home</a>
                                    </li>
                                    <li class="breadcrumb-item"><a
                                            href="exercise-plans.html?menu_item=exercise_plan">Exercise</a></li>
                                    <li class="breadcrumb-item active" aria-current="page">Exercise Configuration</li>
                                </ol>
                            </nav>
                            <!-- /Breadcrumb -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- Container -->
            <div class="container-fluid mt-sm-20 mt-15">
                <!-- Row -->
                <div class="row">
                    <div class="col-xl-12">
                        <!-- Wrapper -->
                        <section class="hk-sec-wrapper">
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="txt_plan_name">Exercise Plan:</label>
                                    <input type="text" class="form-control" id="txt_plan_name" placeholder="Plan Name">
                                </div>
                                <div class="col-md-6">
                                    <label for="list_category">Exercise Category:</label>
                                    <select class="form-control" id="list_category">
                                        <option value="" hidden selected>Exercise Category</option>
                                        <option value="Weight Loss">Weight Loss</option>
                                        <option value="Muscle Gain">Muscle Gain</option>
                                        <option value="Bodybuilding">Bodybuilding</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row mt-10">
                                <div class="col-md-12">
                                    <div class="d-flex float-right" id="div_diet_button">
                                        <button class="btn btn-primary m-1 d-none" id="btn_exercise_create"
                                            onclick="createExercisePlan()"><i class="fas fa-plus"></i> Create</button>
                                        <button class="btn btn-success m-1 d-none" id="btn_exercise_update"
                                            onclick="updateExercisePlan()"><i class="fas fa-check"></i> Update</button>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <!-- Wrapper -->
                        <section class="hk-sec-wrapper" id="exercise-div" style="display: none;">
                            <div class="col-md-12 mb-3 pl-0">
                                <h4>Exercise Plan Create/Update</h4>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mt-15">
                                    <div>
                                        <table id="tbl_meal"
                                            class="mt-15 table table-bordered table-striped display pb-30"
                                            style="width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>No.</th>
                                                    <th>Day</th>
                                                    <th>Exercise Name</th>
                                                    <th>Set/Reps</th>
                                                    <th>Action</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr align="center">
                                                    <td colspan="6"><img src="dist/img/loader.gif" style="width:30px">
                                                    </td>
                                                    <td hidden></td>
                                                    <td hidden></td>
                                                    <td hidden></td>
                                                    <td hidden></td>
                                                </tr>
                                            </tbody>
                                            <tfoot>
                                                <tr>
                                                    <th>No.</th>
                                                    <th>Day</th>
                                                    <th>Exercise Name</th>
                                                    <th>Set/Reps</th>
                                                    <th>Action</th>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>
                                <div class="col-md-6 mt-15">
                                    <div>
                                        <div id="dietPdf" class="dietPdf">
                                            <div class="bg-check">
                                                <div class="col-md-12 text-center">
                                                    <h1 style="font-size: 20px;">Exercise Plan PDF</h1>
                                                </div>
                                                <div class="border mt-15">
                                                    <div class="diet-head mt-10 px-4">
                                                        <p class="mb-0">Plan Name:- <span id="txt_set_meal"></span></p>
                                                        <div class="row">
                                                            <div class="col">
                                                                <p>Plan Category:- <span id="txt_set_category">Find
                                                                        Me</span></p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="diet-body">
                                                        <div class="px-4">
                                                            <table id="tbl_exercise_body"
                                                                class="mt-15 table table-bordered table-striped display pb-30"
                                                                style="width: 100%;">
                                                                <thead>
                                                                    <tr>
                                                                        <th>No.</th>
                                                                        <th>Days</th>
                                                                        <th>Exercise</th>
                                                                        <th>Reps and Sets</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr align="center">
                                                                        <td colspan="6"><img src="dist/img/loader.gif"
                                                                                style="width:30px">
                                                                        </td>
                                                                        <td hidden></td>
                                                                        <td hidden></td>
                                                                        <td hidden></td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                            <div class="diet-notes mb-3 px-4">
                                                                <h5 class="text-danger mb-1">Notes</h5>
                                                                <ul style="list-style: disc;">
                                                                    <li>Exercise Routine: Stick to your exercise routine
                                                                        consistently for the best results.</li>
                                                                    <li>Warm-Up: Always start with a proper warm-up to
                                                                        prevent injury.</li>
                                                                    <li>Form and Technique: Maintain proper form and
                                                                        technique during exercises to avoid injury and
                                                                        maximize effectiveness.
                                                                    </li>
                                                                    <li>Progressive Overload: Gradually increase the
                                                                        intensity of your workouts to challenge your
                                                                        body.</li>
                                                                    <li> Rest Days: Include rest
                                                                        days in your routine to
                                                                        allow your body to recover.</li>
                                                                    <li> Hydration: Stay hydrated before, during, and
                                                                        after
                                                                        your workouts.</li>
                                                                    <li>Variety: Incorporate a variety of exercises to
                                                                        target different muscle groups and prevent
                                                                        boredom.
                                                                    </li>
                                                                    <li> Listen to Your Body: Pay attention to your
                                                                        body's
                                                                        signals and adjust your workouts accordingly.
                                                                    </li>
                                                                    <li> Cool Down: Finish each workout with a proper
                                                                        cool-down and stretching routine.</li>
                                                                </ul>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="col-md-12 text-center mt-15">
                                            <button class="download-pdf-button btn-outline-success btn p-1"
                                                onclick="downloadPDF()">Download
                                                PDF</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
                <!-- /Row -->
            </div>
            <!-- /Container -->


        </div>
        <!-- /Main Content -->

    </div>
    <!-- /HK Wrapper -->

    <!-- Modal -->
    <div class="modal fade" id="modal_meal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Update Exercise</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col">
                            <div class="form-outline">
                                <label class="form-label" for="txt_days">Day</label>
                                <input type="text" required placeholder="Enter day" id="txt_days"
                                    class="form-control" />
                            </div>
                        </div>
                    </div>
                    <div id="exerciseFields">
                        <!-- Existing exercise fields will be added here dynamically -->
                    </div>
                    <button type="button" class="btn btn-primary" id="addExerciseBtn">+ Add Exercise</button>
                </div>
                <div class="modal-footer">
                    <div id="div_modal_button">
                        <button type="button" class="btn btn-primary" onclick="addExercisePlanDetails()"
                            style="float: right;" id="btn_add">Create Exercise</button>
                        <button type="button" class="btn btn-primary" onclick="updateExerciseDetails()"
                            style="float: right; display: none;" id="btn_update">Update Exercise</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <p class="d-none" id="hidden_exercise_id"></p>
    <!-- jQuery -->
    <script src="dist/vendors4/jquery/dist/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="dist/vendors4/popper.js/dist/umd/popper.min.js"></script>
    <script src="dist/vendors4/bootstrap/dist/js/bootstrap.min.js"></script>

    <!-- Slimscroll JavaScript -->
    <script src="dist/js/jquery.slimscroll.js"></script>

    <!-- Fancy Dropdown JS -->
    <script src="dist/js/dropdown-bootstrap-extended.js"></script>

    <!-- FeatherIcons JavaScript -->
    <script src="dist/js/feather.min.js"></script>

    <!-- Toggles JavaScript -->
    <script src="dist/vendors4/jquery-toggles/toggles.min.js"></script>
    <script src="dist/js/toggle-data.js"></script>

    <!-- Toastr JS -->
    <script src="dist/vendors4/jquery-toast-plugin/dist/jquery.toast.min.js"></script>

    <!-- Counter Animation JavaScript -->
    <script src="dist/vendors4/waypoints/lib/jquery.waypoints.min.js"></script>
    <script src="dist/vendors4/jquery.counterup/jquery.counterup.min.js"></script>

    <!-- Data Table JavaScript -->
    <script src="dist/vendors4/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="dist/vendors4/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="dist/vendors4/datatables.net-dt/js/dataTables.dataTables.min.js"></script>
    <script src="dist/vendors4/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="dist/vendors4/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
    <script src="dist/vendors4/datatables.net-buttons/js/buttons.flash.min.js"></script>
    <script src="dist/vendors4/jszip/dist/jszip.min.js"></script>
    <script src="dist/vendors4/pdfmake/build/pdfmake.min.js"></script>
    <script src="dist/vendors4/pdfmake/build/vfs_fonts.js"></script>
    <script src="dist/vendors4/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="dist/vendors4/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="dist/vendors4/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="dist/js/dataTables-data.js"></script>

    <!-- Morris Charts JavaScript -->
    <script src="dist/vendors4/raphael/raphael.min.js"></script>
    <script src="dist/vendors4/morris.js/morris.min.js"></script>

    <!-- Easy pie chart JS -->
    <script src="dist/vendors4/easy-pie-chart/dist/jquery.easypiechart.min.js"></script>

    <!-- Sweet-alert -->
    <script src="dist/sweetalert2.js"></script>

    <!-- EChartJS JavaScript -->
    <script src="dist/vendors4/echarts/dist/echarts-en.min.js"></script>

    <!-- Init JavaScript -->
    <script src="dist/js/init.js"></script>
    <script src="dist/js/dashboard2-data.js"></script>

    <!-- Pace -->
    <script src="dist/vendors4/pace-progress/pace.min.js"></script>

    <!-- Custom js -->
    <script src="dist/app.js"></script>
    <script src="dist/menu-items.js"></script>

    <!-- Authorization -->
    <script src="dist/authorization.js"></script>

    <!-- Select2 JavaScript -->
    <script src="dist/vendors4/select2/dist/js/select2.full.min.js"></script>

    <!-- PDF Make  -->
    <script src="dist/js/pdfMake.js"></script>
    <script src="dist/js/jsPdf.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.0/html2canvas.min.js"></script>
</body>
<script>

    $(document).ready(function () {
        let exerciseCount = 0;

        // Add Exercise Button Click Event
        $("#addExerciseBtn").click(function () {
            exerciseCount++;

            const exerciseFields = $("#exerciseFields");

            // Create a new row for each exercise
            const exerciseRow = $("<div class='row mb-3'></div>");

            // Create Exercise Name Input
            const exerciseNameCol = $("<div class='col'></div>");
            const exerciseNameDiv = $("<div class='form-outline'></div>");
            const exerciseNameLabel = $("<label class='form-label'>Exercise Name</label>");
            const exerciseNameInput = $(`<input type='text' required placeholder='Enter Exercise Name' class='form-control exercise_name' name='exerciseName[]' />`);
            exerciseNameDiv.append(exerciseNameLabel);
            exerciseNameDiv.append(exerciseNameInput);
            exerciseNameCol.append(exerciseNameDiv);

            // Create Rep and Sets Input
            const repSetsCol = $("<div class='col'></div>");
            const repSetsDiv = $("<div class='form-outline'></div>");
            const repSetsLabel = $("<label class='form-label'>Rep and Sets</label>");
            const repSetsInput = $(`<input type='text' required placeholder='Enter Rep and Sets' class='form-control rep_sets' name='repSets[]' />`);
            repSetsDiv.append(repSetsLabel);
            repSetsDiv.append(repSetsInput);
            repSetsCol.append(repSetsDiv);

            // Create Remove Button
            const removeButtonCol = $("<div class='col'><label class='form-label'>Action</label> </div>");
            const removeButton = $("<button type='button' class='btn btn-danger'>Remove</button>");
            removeButton.click(function () {
                exerciseRow.remove(); // Remove the exercise field when the "Remove" button is clicked
            });
            removeButtonCol.append(removeButton);

            // Append Exercise Name, Rep and Sets, and Remove button to the exercise row
            exerciseRow.append(exerciseNameCol);
            exerciseRow.append(repSetsCol);
            exerciseRow.append(removeButtonCol);

            // Append the exercise row to the exercise fields container
            exerciseFields.append(exerciseRow);
        });
    });

    function addExercisePlanDetails() {
        const day = $('#txt_days').val();
        let exerciseNames = $('.exercise_name').map(function () {
            return $(this).val();
        }).get();
        let repAndSets = $('.rep_sets').map(function () {
            return $(this).val();
        }).get();

        const payload = {
            exercise_id: urlParams.get('exercise_plan_id'),
            exercise_name: exerciseNames,
            day: day,
            rep_and_sets: repAndSets
        };
        $.post({
            url: BASE_URL + '/exercise-details/add-exercise-details',
            contentType: 'application/json',
            data: JSON.stringify(payload),
            success: (result) => {
                $('#modal_meal').modal('hide');
                toastSuccess('Success', 'Exercise Plan Created successfully');
                getExercisePlanDetails();
            },
            error: (error) => {
                toastError('Error', error.responseJSON ? error.responseJSON.message : 'An error occurred');
            }
        });
    }


    window.jsPDF = window.jspdf.jsPDF
    function printInvoice() {
        window.print();
    }

    function downloadPDF() {
        let diet_plan_name = $('#txt_plan_name').val();
        const { jsPDF } = window.jspdf;

        var pageWidth = 600;
        var pageHeight = 1000;

        // Create a new jsPDF instance with custom page size
        var doc = new jsPDF('p', 'mm', [pageWidth, pageHeight]);

        var pdfjs = document.querySelector('#dietPdf');

        // Define initial margins (in mm)
        var topMargin = 30;
        var leftMargin = 30;

        // Function to add a new page if needed and adjust margins
        function addPageIfNeeded(doc) {
            if (yOffset + pdfjs.offsetHeight + topMargin > pageHeight) {
                doc.addPage();
                yOffset = topMargin;
                xOffset = leftMargin;
            }
        }

        // Set initial position
        var xOffset = leftMargin;
        var yOffset = topMargin;

        // Convert HTML to PDF in JavaScript
        doc.html(pdfjs, {
            x: xOffset, // Start from the left margin
            y: yOffset,  // Start from the top margin
            callback: function (doc) {
                // Save the PDF and open a new page if needed
                doc.save(`${diet_plan_name}-Diet-Plan.pdf`);
                addPageIfNeeded(doc); // Check if content overflows the page
            }
        });
    }

    const urlParams = new URLSearchParams(window.location.search);
    const exercise_plan_id = urlParams.get("exercise_plan_id")

    var tblExerciseDetails = $('#tbl_meal').DataTable({
        responsive: true,
        paging: false,
        language: {
            search: "_INPUT_",
            searchPlaceholder: "Search...",
            "sLengthMenu": "Show _MENU_ Records",
        },
        "dom": '<"row"<"#idid.col-7"><"col-5"fl><"col-12"rt><"col-12">><"row"<"col-12"ip>><"clear">',
        "columns": [
            { "width": "5%" },
            { "width": "15%" },
            { "width": "15%" },
            { "width": "15%" },
            { "width": "25%" },
        ]
    });

    var tblExerciseBody = $('#tbl_exercise_body').DataTable({
        responsive: true,
        ordering: false,
        paging: false,
        "dom": '<"row"<"col-7"><"col-5"><"col-12"rt><"col-12">><"row"<"col-12">><"clear">',
        "columns": [
            { "width": "2%" },
            { "width": "10%" },
            { "width": "25%" },
            { "width": "35%" },
        ]
    });

    // Add content to col-7
    $('#idid').html(
        '<div class="">' +
        '<button class="btn px-3 py-1 text-white" style="background-color: #0854ff;" onclick="openModal()"><i class="fa fa-plus"></i> Create</button>' +
        '</div>');

    if (exercise_plan_id) {
        // If exercise_plan_id is available, show the Update button and load existing data
        $('#exercise-div').show();
        $('#btn_exercise_update').removeClass('d-none');
    } else {
        // If exercise_plan_id is not available, show the Create button
        $('#exercise-div').hide();
        $('#btn_exercise_create').removeClass('d-none');
    }

    function openModal() {
        $('#btn_update').hide();
        $('#btn_add').show();
        $('.modal-title').text('Create Exercise');
        $('#txt_days').val('');
        $('.exercise_name').val('');
        $('.rep_sets').val('');
        $('#modal_meal').modal('show');
    }

    $(document).ready(() => {
        getExercisePlan();
        getExercisePlanDetails();
        getFood();
    });

    function getExercisePlan() {
        $.get({
            url: BASE_URL + '/exercise-plan/get-exercise-plan',
            contentType: 'application/json',
            success: (result) => {
                var resultData = result.data;
                if (resultData) {
                    var matchingDiet = resultData.find(tempUser => tempUser._id === exercise_plan_id);
                    if (matchingDiet) {
                        $('#txt_plan_name').val(matchingDiet.plan_name);
                        $('#list_category').val(matchingDiet.exercise_type);
                        $('#txt_set_meal').text(matchingDiet.plan_name);
                        $('#txt_set_category').text(matchingDiet.exercise_type);
                    }
                }
            },
            error: (error) => {
                const errorMessage = error.responseJSON ? error.responseJSON.message : 'Error';
                toastError('Error', errorMessage);
            }
        });
    }

    function getExercisePlanDetails() {
        $.get({
            url: BASE_URL + '/exercise-details/get-exercise-details',
            contentType: 'application/json',
            success: (result) => {
                const allDietDetails = result.data;
                let { data } = result;
                // console.log(data)

                if (exercise_plan_id) {
                    data = data.filter(tempDiet => tempDiet.exercise_id === exercise_plan_id);
                }
                console.log()
                tblExerciseDetails.clear().draw();
                tblExerciseBody.clear().draw();
                var tableRow = [];
                var dietTableRow = [];
                data.forEach((tempDiet, index) => {
                    let description = tempDiet.description || 'N/A';
                    let exercise = tempDiet.exercise_name ? tempDiet.exercise_name.join('<br>') : 'No Exercise Found'; // Use <br> for line breaks
                    let rep_sets = tempDiet.rep_and_sets ? tempDiet.rep_and_sets.join('<br>') : 'No Data Found'

                    var actionHTML = "";
                    actionHTML += `<button type="button" class="btn btn-success mr-1 px-2 py-1" onclick=updateExerciseDetailsOpen("${tempDiet._id}",this)><i class="fas fa-edit"></i> </button>`;
                    actionHTML += `<button type="button" class="btn btn-danger px-2 py-1" onclick=removeExerciseDetails("${tempDiet._id}",this)><i class="fa fa-trash"></i> </button>`;

                    tableRow.push([index + 1, tempDiet.day, exercise, rep_sets, actionHTML]);
                    dietTableRow.push([index + 1, tempDiet.day, exercise, rep_sets])
                });

                tblExerciseDetails.rows.add(tableRow).draw();
                tblExerciseBody.rows.add(tableRow).draw();
            },
            error: (error) => {
                const errorMessage = error.responseJSON ? error.responseJSON.message : 'Error';
                toastError('Error', errorMessage);
            }
        });
    }

    function updateExerciseDetailsOpen(id) {
        // Fetch data from API based on the id
        $.get({
            url: BASE_URL + `/exercise-details/get-exercise-details?exercise_id=${id}`,
            contentType: 'application/json',
            success: (result) => {
                const exerciseDetailsArray = result.data;
                // Clear existing exercise fields
                $("#exerciseFields").empty();

                if (exerciseDetailsArray.length > 0) {
                    exerciseDetailsArray.forEach((exerciseDetail) => {
                        $('#txt_days').val(exerciseDetail.day);
                        // Set the fetched data in the exercise fields
                        setExerciseData(exerciseDetail.exercise_name, exerciseDetail.rep_and_sets);
                    });

                    // Store the _id in a hidden input field (you can decide where to store this)
                    $('#hidden_exercise_id').val(exerciseDetailsArray[0]._id);

                    $('#btn_add').hide();
                    $('#btn_update').show();
                    $('.modal-title').text('Update Exercise');
                    $('#modal_meal').modal('show');
                } else {
                    // Handle the case where no data was found for the given id
                    console.log('Exercise detail not found');
                }
            },
            error: (error) => {
                const errorMessage = error.responseJSON ? error.responseJSON.message : 'Error';
                toastError('Error', errorMessage);
            }
        });
    }

    function setExerciseData(exerciseNames, repSets) {
        const exerciseFields = $("#exerciseFields");

        if (exerciseNames.length !== repSets.length) {
            // Handle the case where the arrays have different lengths (optional)
            console.log('Exercise names and rep sets arrays have different lengths');
            return;
        }

        for (let i = 0; i < exerciseNames.length; i++) {
            // Create a new row for each exercise
            const exerciseRow = $("<div class='row mb-3'></div>");

            // Create Exercise Name Input
            const exerciseNameCol = $("<div class='col'></div>");
            const exerciseNameDiv = $("<div class='form-outline'></div>");
            const exerciseNameLabel = $("<label class='form-label'>Exercise Name</label>");
            const exerciseNameInput = $(`<input type='text' required placeholder='Enter Exercise Name' class='form-control exercise_name' name='exerciseName[]' />`);
            exerciseNameInput.val(exerciseNames[i]); // Set the exercise name
            exerciseNameDiv.append(exerciseNameLabel);
            exerciseNameDiv.append(exerciseNameInput);
            exerciseNameCol.append(exerciseNameDiv);

            // Create Rep and Sets Input
            const repSetsCol = $("<div class='col'></div>");
            const repSetsDiv = $("<div class='form-outline'></div>");
            const repSetsLabel = $("<label class='form-label'>Rep and Sets</label>");
            const repSetsInput = $(`<input type='text' required placeholder='Enter Rep and Sets' class='form-control rep_sets' name='repSets[]' />`);
            repSetsInput.val(repSets[i]); // Set the rep and sets
            repSetsDiv.append(repSetsLabel);
            repSetsDiv.append(repSetsInput);
            repSetsCol.append(repSetsDiv);

            // Create Remove Button
            const removeButtonCol = $("<div class='col'><label class='form-label'>Action</label> </div>");
            const removeButton = $("<button type='button' class='btn btn-danger'>Remove</button>");
            removeButton.click(function () {
                exerciseRow.remove(); // Remove the exercise field when the "Remove" button is clicked
            });
            removeButtonCol.append(removeButton);

            // Append Exercise Name, Rep and Sets, and Remove button to the exercise row
            exerciseRow.append(exerciseNameCol);
            exerciseRow.append(repSetsCol);
            exerciseRow.append(removeButtonCol);

            // Append the exercise row to the exercise fields container
            exerciseFields.append(exerciseRow);
        }
    }


    function updateExerciseDetails() {
        const exercise_id = $('#hidden_exercise_id').val();
        console.log(exercise_id)
        const day = $('#txt_days').val();
        let exerciseNames = $('.exercise_name').map(function () {
            return $(this).val();
        }).get();
        let repAndSets = $('.rep_sets').map(function () {
            return $(this).val();
        }).get();

        const payload = {
            exercise_id: exercise_id,
            exercise_name: exerciseNames,
            day: day,
            rep_and_sets: repAndSets
        };
        $.post({
            url: BASE_URL + '/exercise-details/update-exercise-details',
            contentType: 'application/json',
            data: JSON.stringify(payload),
            success: (result) => {
                toastSuccess('Success', 'Exercise Data Updated successfully');
                $('#modal_meal').modal('hide');
                getExercisePlanDetails();
            },
            error: (error) => {
                const errorMessage = error.responseJSON ? error.responseJSON.message : 'Error';
                toastError('Error', errorMessage);
            }
        });
    }

    function createExercisePlan() {
        let plan_name = $('#txt_plan_name').val();
        let exercise_type = $('#list_category').val();

        let payload = {
            plan_name,
            exercise_type,
        };

        $.post({
            url: BASE_URL + '/exercise-plan/add-exercise-plan',
            contentType: 'application/json',
            data: JSON.stringify(payload),
            success: (result) => {
                toastSuccess('Success', 'Exercise Plan Created successfully');
                window.location.href = 'exercise-plans.html'
            },
            error: (error) => {
                toastError('Error', error.responseJSON ? error.responseJSON.message : 'An error occurred');
            }
        });
    }

    function updateExercisePlan() {
        let plan_name = $('#txt_plan_name').val();
        let exercise_type = $('#list_category').val();
        let id = urlParams.get("exercise_plan_id");

        let payload = {
            id,
            plan_name,
            exercise_type,
        };

        $.post({
            url: BASE_URL + '/exercise-plan/update-exercise-plan',
            contentType: 'application/json',
            data: JSON.stringify(payload),
            success: (result) => {
                toastSuccess('Success', 'Exercise Plan Created successfully');
                window.location.href = 'exercise-plans.html'
            },
            error: (error) => {
                toastError('Error', error.responseJSON ? error.responseJSON.message : 'An error occurred');
            }
        });
    }

    function removeExerciseDetails(exercise_plan_id) {
        Swal.fire({
            title: 'Are you sure?',
            text: `You are about to remove this Exercise Data`,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, remove it!',
        }).then((result) => {
            if (result.isConfirmed) {
                $.post({
                    url: `${BASE_URL}/exercise-details/remove-exercise-details`,
                    data: { details_id: exercise_plan_id },
                    success: function (response) {
                        getExercisePlanDetails();
                        Swal.fire('Removed!', `The Exercise plan data has been successfully Removed.`, 'success');
                    },
                    error: function (error) {
                        var errorMessage = error.responseJSON ? error.responseJSON.message : 'Error';
                        Swal.fire('Error!', errorMessage, 'error');
                    }
                });
            }
        });
    }
</script>

</html>